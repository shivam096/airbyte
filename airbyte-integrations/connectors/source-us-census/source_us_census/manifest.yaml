version: "0.29.0"

definitions:
  selector:
    type: RecordSelector
    extractor:
      type: DpathExtractor
      field_path: []
  requester:
    type: HttpRequester
    url_base: "https://api.census.gov"
    http_method: "GET"
    request_parameters:
      get: "{{ config.get('query_params') }}"
    authenticator:
      type: BearerAuthenticator
      api_token: "{{ config['api_key'] }}"
  retriever:
    type: SimpleRetriever
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      type: NoPagination
    requester:
      $ref: "#/definitions/requester"
  base_stream:
    type: DeclarativeStream
    retriever:
      $ref: "#/definitions/retriever"
  us_census_stream:
    $ref: "#/definitions/base_stream"
    name: "us_census_stream"
    $parameters:
      path: "/{{ config.get('query_path') }}"

streams:
  - "#/definitions/us_census_stream"

check:
  type: CheckStream
  stream_names:
    - "us_census_stream"

spec:
  type: Spec
  documentation_url: https://docs.airbyte.com/integrations/sources/us-census
  connection_specification:
    title: Us Census Spec
    type: object
  required:
  - api_key
  - query_path
  additionalProperties: true
  properties:
    query_params:
      type: string
      description: The query parameters portion of the GET request, without the api
        key
      pattern: "^\\w+=[\\w,:*]+(&(?!key)\\w+=[\\w,:*]+)*$"
      examples:
      - get=NAME,NAICS2017_LABEL,LFO_LABEL,EMPSZES_LABEL,ESTAB,PAYANN,PAYQTR1,EMP&for=us:*&NAICS2017=72&LFO=001&EMPSZES=001
      - get=MOVEDIN,GEOID1,GEOID2,MOVEDOUT,FULL1_NAME,FULL2_NAME,MOVEDNET&for=county:*
    query_path:
      type: string
      description: The path portion of the GET request
      pattern: "^data(\\/[\\w\\d]+)+$"
      examples:
      - data/2019/cbp
      - data/2018/acs
      - data/timeseries/healthins/sahie
    api_key:
      type: string
      description: Your API Key. Get your key <a href="https://api.census.gov/data/key_signup.html">here</a>.
      airbyte_secret: true
